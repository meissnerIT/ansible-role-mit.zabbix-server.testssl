---

- name: "rsync testssl.sh (directory, distribution)"
  synchronize: 
    src: testssl.sh/
    dest: /usr/local/share/testssl.sh/
    delete: yes
    rsync_opts:
      - "--exclude=.git"

- name: Copy wrapper scripts
  copy:
    src: "{{ item }}"
    dest: /usr/lib/zabbix/externalscripts/
    mode: 0755
  loop:
    - mit-check-cert.py
    - mit-check-cert.sh

- name: Install python3-pip
  apt:
    pkg: python3-pip

# zabbix-mit-testssl
- name: Install pyzabbix via pip3
  pip:
    executable: pip3
    name: pyzabbix>=1.3.0

- name: Copy zabbix-mit-testssl*
  copy:
    src: "{{ item}}"
    dest: /usr/local/bin/
    mode: 0755    
  loop:
    - zabbix-mit-testssl
    - zabbix-mit-testssl-caller
    - zabbix-mit-testssl-helper

- name: "Copy cronjob"
  copy:
    src: local-zabbix-mit-testssl-caller
    dest: /etc/cron.d/

